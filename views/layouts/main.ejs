<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title><%= pageTitle %> — <%= site.brand.name %></title>
  <meta name="description" content="<%= metaDescription || '' %>"/>

  <meta property="og:title" content="<%= pageTitle %> — <%= site.brand.name %>"/>
  <meta property="og:description" content="<%= metaDescription || '' %>"/>
  <meta property="og:image" content="<%= site.seo.ogImage %>"/>
  <meta property="og:type" content="website"/>

  <link rel="preload" as="style" href="/public/css/styles.css"/>
  <link rel="stylesheet" href="/public/css/styles.css"/>
  <link rel="icon" href="/public/assets/logos/logo.svg" type="image/svg+xml"/>
</head>
<body>
  <a class="skip" href="#content">Перейти к содержимому</a>

  <%- include('../partials/header') %>

  <main id="content" class="main">
    <%- body %>
  </main>

  <%- include('../partials/footer') %>

  <%- include('../partials/cookieBanner') %>

  <div class="modal modal--gallery" data-gallery-modal hidden>
    <div class="modal__overlay" data-gallery-close></div>
    <div class="modal__panel modal__panel--wide" role="dialog" aria-modal="true" aria-label="Просмотр фото">
      <button class="modal__close" type="button" data-gallery-close aria-label="Закрыть">×</button>
      <h3 class="h3 modal__gallery-title" data-gallery-title></h3>
      <div class="gallery-viewer">
        <button class="gallery-viewer__prev" type="button" data-gallery-prev aria-label="Назад">‹</button>
        <div class="gallery-viewer__main">
          <img data-gallery-img src="" alt="" loading="lazy">
        </div>
        <button class="gallery-viewer__next" type="button" data-gallery-next aria-label="Вперёд">›</button>
      </div>
      <div class="gallery-viewer__counter" data-gallery-counter></div>
    </div>
  </div>

  <script defer src="/public/js/main.js"></script>
  <script>
  (function() {
    var key = 'cookieConsent';
    var banner = document.getElementById('cookie-banner');
    if (!banner) return;
    if (localStorage.getItem(key)) {
      banner.hidden = true;
      return;
    }
    document.getElementById('cookie-banner-accept').addEventListener('click', function() {
      localStorage.setItem(key, 'accepted');
      banner.hidden = true;
    });
  })();
  </script>
  <script>
  (function() {
    const modal = document.querySelector('[data-gallery-modal]');
    if (!modal) return;
    const titleEl = modal.querySelector('[data-gallery-title]');
    const imgEl = modal.querySelector('[data-gallery-img]');
    const counterEl = modal.querySelector('[data-gallery-counter]');
    let currentAlbum = null;
    let currentIndex = 0;
    function open(album) {
      currentAlbum = album;
      currentIndex = 0;
      titleEl.textContent = album.title;
      updateImage();
      modal.hidden = false;
      document.body.style.overflow = 'hidden';
    }
    function updateImage() {
      if (!currentAlbum || !currentAlbum.images.length) return;
      imgEl.src = currentAlbum.images[currentIndex];
      imgEl.alt = currentAlbum.title + ' — фото ' + (currentIndex + 1);
      if (counterEl) counterEl.textContent = (currentIndex + 1) + ' / ' + currentAlbum.images.length;
    }
    function next() {
      if (!currentAlbum || !currentAlbum.images.length) return;
      currentIndex = (currentIndex + 1) % currentAlbum.images.length;
      updateImage();
    }
    function prev() {
      if (!currentAlbum || !currentAlbum.images.length) return;
      currentIndex = currentIndex === 0 ? currentAlbum.images.length - 1 : currentIndex - 1;
      updateImage();
    }
    function close() {
      modal.hidden = true;
      document.body.style.overflow = '';
    }
    modal.querySelectorAll('[data-gallery-close]').forEach(el => el.addEventListener('click', close));
    const prevBtn = modal.querySelector('[data-gallery-prev]');
    const nextBtn = modal.querySelector('[data-gallery-next]');
    if (prevBtn) prevBtn.addEventListener('click', prev);
    if (nextBtn) nextBtn.addEventListener('click', next);
    document.addEventListener('click', function(e) {
      const btn = e.target.closest('[data-gallery-open]');
      if (!btn) return;
      e.preventDefault();
      const id = btn.getAttribute('data-gallery-id');
      const album = window.__galleryAlbums && window.__galleryAlbums[id];
      if (album) open(album);
    });
    document.addEventListener('keydown', function(e) {
      if (modal.hidden) return;
      if (e.key === 'Escape') close();
      if (e.key === 'ArrowLeft') prev();
      if (e.key === 'ArrowRight') next();
    });
  })();
  </script>
</body>
</html>
